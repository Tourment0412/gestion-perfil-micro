spring.application.name=gestion-perfil

# Server configuration
server.port=8080

# Database configuration
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/mydatabase}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:myuser}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:secret}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA/Hibernate configuration
spring.jpa.hibernate.ddl-auto=${SPRING_JPA_HIBERNATE_DDL_AUTO:update}
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.use_sql_comments=true

# RabbitMQ connection settings
# Prefer explicit SPRING_RABBITMQ_* env vars, then fall back to common RABBITMQ_* vars, then sensible defaults
# Defaults are aligned with the rabbit service defined in docker-compose.unified.yml (host: rabbitmq, vhost: foro)
spring.rabbitmq.host=${SPRING_RABBITMQ_HOST:rabbitmq}
spring.rabbitmq.port=${SPRING_RABBITMQ_PORT:5672}
spring.rabbitmq.username=${SPRING_RABBITMQ_USERNAME:${RABBITMQ_USERNAME:gestorperfil_user}}
spring.rabbitmq.password=${SPRING_RABBITMQ_PASSWORD:${RABBITMQ_PASSWORD:gestor_pass}}
spring.rabbitmq.virtual-host=${SPRING_RABBITMQ_VIRTUAL_HOST:${RABBITMQ_VHOST:foro}}

# RabbitMQ listener configuration
spring.rabbitmq.listener.simple.concurrency=1
spring.rabbitmq.listener.simple.max-concurrency=5
spring.rabbitmq.listener.simple.acknowledge-mode=auto
spring.rabbitmq.template.retry.enabled=false
spring.rabbitmq.template.mandatory=true

# RabbitMQ queue configuration
spring.rabbitmq.listener.simple.default-requeue-rejected=false

# Actuator configuration
management.endpoints.enabled-by-default=false
management.endpoint.health.enabled=true
management.endpoint.health.show-details=always
management.endpoint.health.probes.enabled=true
# Solo usar database para readiness (el health indicator de RabbitMQ se llama 'rabbit' automáticamente)
management.endpoint.health.group.readiness.include=database
management.endpoint.health.group.liveness.include=application
# Deshabilitar validación estricta de grupos
management.endpoint.health.validate-group-membership=false

# Logging configuration
logging.level.root=INFO
logging.level.com.uniquindio.archmicroserv.gestion_perfil=DEBUG
logging.level.org.springframework.amqp=${LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_AMQP:INFO}
logging.level.org.springframework.rabbit=${LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_RABBIT:INFO}
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
